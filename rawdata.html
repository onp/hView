<!doctype html>

<html lang=en>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="Is it cold?">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>hView</title>

  <style>
  td {
    border: 1px solid black;
    width: 6em;
    text-align: center;
  }
  </style>

</head>

<body>
<h1>hView</h1>
<div id=content>
  <p>Waiting for data...</p>
</div>


<script src="https://www.gstatic.com/firebasejs/5.8.4/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.8.4/firebase-firestore.js"></script>
<script src="lib/d3.js"></script>
<script>
  // Initialize Firebase
  firebase.initializeApp({
    apiKey: "AIzaSyCch8gDaGfQhOFVroFCZHKosa3oOU-WvPE",
    authDomain: "templogger-233703.firebaseapp.com",
    projectId: "templogger-233703",
  });
  var db = firebase.firestore();
</script>

<script>
  //ref for content node
  var ct = document.querySelector('#content')
  var today = new Date()
  var todayStr = today.getFullYear() + '-' + (today.getMonth()+1) + "-" + (today.getDate())
  todayStr = "2019-11-28"

  // setup margins for plot area
  var m = [80, 160, 100, 160],
    w = window.innerWidth - m[1] - m[3],
    h = window.innerHeight - m[0] - m[2];

  //get temp data for current day
  var doc = db.collection("tempDaily").doc(todayStr);
  doc.get().then(function(qs) {
    var d1 = qs.data()

    ct.textContent = d1.data;
    makePlot(d1.data)

  })

  function makePlot(data){
    var d = d3.csvparse("date,humidity,temp\n" + data, d3.autoType)

    d3.select("#content").selectAll("p").data(d)
      .enter().append("p")
        .text(d => String(d))

  }


</script>

</body>
</html>
